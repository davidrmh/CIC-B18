\documentclass[10pt,letterpaper,onecolumn]{llncs}
\usepackage[latin1]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{cite}
\usepackage{caption}
\usepackage{float}

\pagestyle{empty}
\begin{document}


\title{Aprendizaje de reglas para operaciones en el mercado accionario. \\
Avances de tesis \\ Tercer semestre.}

\author{David Ricardo Montalván Hernández}

\institute{ Instituto Politécnico Nacional, Centro de Investigación en Computación, Ciudad de México, México.\\
\email{davidricardo888}@gmail.com}

\maketitle


\begin{abstract}

Con la digitalización de los mercados financieros, en particular, los mercados accionarios; el desarrollo de algoritmos y técnicas computacionales para determinar las estrategias de inversión ha ganado relevancia tanto en la industria como en la academia.

Concretamente, técnicas relacionadas al aprendizaje automático han ganado notoriedad en los últimos años. Dentro de estas técnicas, aquellas que pertenecen a la categoría de "\textbf{cajas negras}" (e.g. máquinas de soporte vectorial, redes neuronales) son las que han tenido una mayor difusión, teniendo menor presencia las llamadas técnicas simbólicas "\textbf{cajas blancas}".

En este trabajo, presento los avances obtenidos hasta el momento en la investigación relacionada a mi tema de tesis. Retomo primeramente algunos conceptos básicos para el entendimiento del tema y posteriormente se analiza el estado del arte recolectado hasta el momento. Se muestran algunos ejercicios bajo del paradigma de "\textbf{cajas negras}" y se señala el camino a tomar para el cuarto semestre, en el cual se realizarán ejercicios bajo el paradigma de "\textbf{cajas blancas}".

\end{abstract}

\section{Objetivos}

\subsection{Objetivo general}
Dentro del paradigma simbólico o subsimbólico, proponer un método o algoritmo para aprender de manera automática un conjunto de reglas para operar en el mercado accionario mexicano.

\subsection{Objetivos particulares}
\begin{itemize}
	\item Selección de atributos relevantes.
	
	\item Proponer una técnica simbólica o subsimbólica y realizar distintos experimentos.
	
	\item Evaluar los resultados de dichos experimentos.
	
	\item Comparar contra la hipótesis del mercado eficiente (versión débil).
	
\end{itemize}

\section{Conceptos Básicos}

\subsection{El sistema financiero}

El sistema financiero se compone de distintos tipos de mercados (e.g. accionario, deuda, cambiario) junto con la participación de distintos intermediarios (personas físicas o morales) los cuales buscan la transferencia de activos (tangibles o intangibles) de un lugar a otro y de un punto en el tiempo a otro.

Los intermediarios recurren al sistema financiero principalmente por las siguientes razones:

\begin{itemize}
	\item Ahorrar dinero para el futuro.
	\item Pedir prestado dinero para utilizarlo en el presente.
	\item Reunir capital para proyectos de inversión futuros.
	\item Administrar riesgos.
\end{itemize}

Dado lo anterior, resulta evidente entonces, que la principal función del sistema financiero es facilitar la negociación entre los intermediarios que participan en el.

\subsection{Acciones y títulos referenciados a acciones}
Para financiar sus proyectos de inversión, las compañías pueden recurrir a distintas formas de financiamiento, entre ellas:

\begin{itemize}
	\item Solicitar un préstamo ante una entidad de crédito.
	\item Emisión o venta de acciones a los inversionistas (accionistas).
\end{itemize}

La primera de estas opciones implica una deuda que se tendrá que pagar (con intereses) en un tiempo futuro; mientras que la segunda involucra ceder una fracción de la compañía hacia los inversionistas, así como garantizarles ciertos derechos sobre los activos de esta.

Así pues, podemos decir que una \textbf{acción} es un activo financiero que representa cierta proporción de los activos de la compañía.

\subsubsection{Títulos referenciados a acciones (TRAC's) \\}

De acuerdo a la página de la Bolsa Mexicana de Valores\footnote{https://www.bmv.com.mx/es/mercados/instrumentos}:\\
\textit{los \textbf{Títulos referenciados a acciones (TRAC's)} son certificados de participación que representan el patrimonio de fideicomisos de inversión y que mantienen en posición canastas de acciones de empresas cotizadas en bolsa} (en términos simples, un TRAC es un activo financiero que representa el comportamiento de un conjunto de acciones)

En México, el TRAC más importante es el \textbf{NAFTRAC ISHRS} el cual está referenciado a las acciones que componen el Índice de Precios y Cotizaciones (S\&P/BMV IPC), el principal indicador del mercado accionario mexicano.

Ya que refleja de manera general el mercado mexicano, este instrumento será sobre el cual estaremos realizando las operaciones de compra y venta.

\subsection{Análisis técnico}
Al momento de invertir, aún cuando la idea básica es \textit{comprar barato y vender caro}, dada la incertidumbre en los mercados financieros, se han desarrollado distintas técnicas para analizar la información que estos generan.

El análisis técnico es una forma de análisis financiero la cual utiliza solamente precios y volúmenes históricos para guiar la toma de decisiones. Generalmente, este tipo de análisis recurre al uso de gráficas para descubrir patrones y tendencias en los precios.

Además, el análisis técnico podría considerarse como el estudio colectivo de la psicología de los inversionistas; ya que, al sólo analizar precios y volúmenes, se analiza el sentimiento de aquellos inversionistas que efectivamente realizaron una transacción (es decir, aquellos inversionistas que lograron realizar una compra o una venta).


\subsubsection{Indicadores técnicos}
Además de utilizar herramientas gráficas para la toma de decisiones, el análisis técnico se vale de los llamados "indicadores técnicos". Estos indicadores, son medidas basadas en el precio, volumen o flujos de fondos que pueden ser utilizadas para predecir cambios en los precios. En otras palabras, los indicadores técnicos son transformaciones realizadas a las series de tiempo de los precios originales, por ejemplo, promedios móviles de los precios de cierre.

\subsection{Hipótesis del mercado eficiente}
La eficiencia de un mercado se refiere a la rapidez en que los precios de este reflejan la información disponible. Si los precios no reflejan totalmente la información, entonces la recopilación y procesamiento de esta podría generar ganancias anormales.

Así pues, decimos que un mercado es \textbf{informacionalmente eficiente (eficiente)} si los precios reflejan la información de manera rápida y racional.

Un mercado eficiente implica la existencia de precios informativos lo que permite a su vez determinar que compañías o proyectos obtendrán el capital que necesitan para su desarrollo, fomentando así el crecimiento económico. Por lo tanto, la eficiencia en un mercado es una característica importante de un sistema financiero sano.

En la práctica, los mercados financieros no se consideran completamente eficientes o ineficientes si no que se encuentran en un rango entre estos dos extremos.

\subsubsection{Formas de eficiencia en el mercado\\}

Se consideran tres formas de eficiencia en el mercado, \cite{Fama1965}, de acuerdo al tipo de información reflejada:\\
\begin{table}[H]
\caption{Formas de eficiencia en el mercado}
\label{tabla-formas-eficiencia}
\centering	
\begin{tabular}{p{3.0cm}p{3.0cm}p{3.0cm}p{3.5cm}}
\hline \textbf{Eficiencia} & \textbf{Precios históricos} & \textbf{Información pública} & \textbf{Información privada} \\ 
\hline Débil & \checkmark  &  &  \\ 
\hline Semifuerte & \checkmark & \checkmark &  \\ 
\hline Fuerte & \checkmark & \checkmark & \checkmark \\ 
\hline 
\end{tabular} 
\end{table}

En su forma débil, los precios reflejan eficientemente toda la información histórica generada por el mercado (precios de apertura, cierre, máximos, mínimos, volumen) por lo tanto, los inversionistas no pueden predecir los precios futuros sólamente extrapolando la información histórica.\\

En su forma semifuerte, los precios reflejan toda la información pública conocida y disponible; esta información incluye tanto la información revelada en los estados financieros de las compañías como la información generada por el mercado. Es claro entonces que un mercado con eficiencia semifuerte, también es débilmente eficiente y además cualquier intento de utilizar la información pública disponible será insustancial al momento de predecir los precios del futuro.\\

Finalmente, un mercado con eficiencia fuerte es aquel en el que los precios reflejan completamente tanto la información pública como la privada (aquella que sólo unos cuantos poseen) y por lo tanto, el uso de esta información para predecir los precios futuros no tiene trascendencia.

\subsubsection{Estrategia Buy and Hold\\}

En un mercado eficiente, los inversionistas optarán por seguir una estrategia de \textbf{inversión pasiva}, es decir, aquella en la que no se realizan cambios al portafolio debido a las expectativas en el corto plazo. Una inversión pasiva consiste pues, en lo siguiente:

\begin{itemize}
	\item[-] Fijar un periodo de tiempo $[0,T]$.
	\item[-] Comprar en $0$ a un precio $P_{0}$.
	\item[-] Vender en $T$ a un precio $P_{T}$.
\end{itemize}

En inglés, esta estrategia se conoce como \textbf{Buy and Hold} y será la estrategia representativa de la hipótesis del mercado eficiente.

Por otra lado, en un mercado ineficiente, los inversionistas optarán por seguir una estrategia de \textbf{inversión activa}. Este tipo de inversión busca generar ganancias superiores a aquellas generadas por la inversión pasiva y consiste en: 

\begin{itemize}
	\item[-] Fijar un periodo de tiempo $[0,T]$.
	\item[-] Comprar en un conjunto de fechas $\{\tau_{c1} < \tau_{c2}, \ldots, \tau_{cn}<T\}$ a precios $\{P_{\tau_{c1}}, P_{\tau_{c2}}, \ldots, P_{\tau_{cn}}   \}$.
	\item[-] Vender en un conjunto de fechas $\{\tau_{v1}, \tau_{v2}, \ldots, \tau_{vn}<=T\}$ a precios $\{P_{\tau_{v1}}, P_{\tau_{v2}}, \ldots, P_{\tau_{vn}}   \}$.
\end{itemize}

En donde las variables $\tau$ y $P$ son variables aleatorias.

Si el mercado es ineficiente, entonces existe una estrategia de inversión activa que generará ingresos netos (es decir, después de considerar costos de transacción) superiores a aquellos generados por una inversión pasiva.



\section{Estado del arte}

En la búsqueda de estrategias de inversión activa que superen a la estrategia \textit{Buy and Hold}, se han explorado distintas técnicas relacionadas al área de inteligencia artificial, por ejemplo, uno de los primeros trabajos es el de \cite{Allen1999}, en el cual se utiliza programación genética para encontrar un conjunto de reglas que permiten indicar los momentos de compra, venta o espera; en este trabajo se analiza el mercado accionario de Estados Unidos utilizando el índice accionario \textit{S\&P 500} (este índice representa a las mejores 500 empresas de Estados Unidos) como instrumento de referencia, se consideran costos de transacción pero no logran vencer las ganancias de la inversión pasiva.\\

En \cite{Leigh2002}, se utilizan heurísticas (\textit{template matching}) basadas en los patrones de la gráfica del precio del índice accionario NYSE Composite (Estados Unidos), se obtienen ganancias superiores a la inversión pasiva pero no se consideran costos de transacción.\\

En \cite{Potvin2004}, se retoma el trabajo de \cite{Allen1999} omitiendo costos de transacción y considerando una forma distinta de generar la población de árboles. Vencen a la estrategia Buy and Hold únicamente en mercados estables o a la baja, pero no logran vencerla en mercados a la alza. En este trabajo en lugar de utilizar índices accionarios se analizan acciones individuales del mercado de Canadá.\\

Siguiendo la línea de programación genética, los autores en \cite{Scott2010} utilizan no sólamente precios diarios, como lo hicieron los trabajos previamente mencionados, si no que también consideran precios semanales y mensuales. Utilizan el índice \textit{S\&P 500} como instrumento de referencia y logran vencer la estrategia Buy and Hold aún considerando costos de transacción.\\
	
\cite{Canelas2012, Canelas2013, Leitao2016} Son una serie de trabajos en los cuales se definen los \textit{Puntos Perceptualmente Importantes (Perceptually Important Points, PIP)} y se utiliza un método llamado \textit{Aproximación Agregada Simbólica, (Symbolic Aggregate Approximation, SAX)}; con estas dos herramientas es posible reducir la dimensionalidad de la serie de tiempo (sólo se consideran los "puntos importantes", en lugar de la serie en su totalidad) y a su vez convertirla en una serie de símbolos (letras de un alfabeto) finalmente se aplica un algoritmo evolutivo para identificar los patrones de símbolos que nos permiten obtener una buena estrategia. Se analiza el mercado de Estados Unidos utilizando el índice \textit{S\&P 500} y obtienen mejores resultados que la estrategia Buy and Hold aunque no consideran costos de transacción.


En \cite{Kampouridis2017} se considera una escala de tiempo basada en eventos y se definen los \textit{cambios direccionales}. Utilizando este concepto se generan estrategias capaces de vencer a la estrategia Buy and Hold aún considerando costos de transacción. Este artículo no analiza el mercado accionario, si no que analiza el mercado de divisas.


Los autores en \cite{Huang2015}, proponen utilizar un biagrupamiento (biclustering) para descubrir patrones, este biagrupamiento agrupa tanto en la dimensión del tiempo como en la dimesión de los atributos. Una vez obtenidos los grupos para cada decisión (compra, venta o espera), se utiliza una modificación del método de K vecinos más cercanos, con el fin de obtener una decisión para el día en cuestión. Obtienen resultados favorecedores analizando distintos mercados accionarios (Estados Unidos, Asia, Canadá) pero no consideran costos de transacción.

\cite{Preen2010, Zhang2015} Utilizan una metodología llamada \textit{Extended Classifier Systems, XCS} la cual, utilizando aprendizaje reforzado junto con heurísticas evolutivas, les permite obtener un conjunto de reglas \textit{if-then} para decidir la acción a tomar el día en cuestión. \cite{Zhang2015} analiza el mercado de índices accionarios de la bolsa de Shangai y vence a la estrategia Buy and Hold considerando costos de transacción, mientras que \cite{Preen2010} analiza diferentes acciones e índices accionarios venciendo a la estrategia Buy and Hold en la mayoría de los casos, considerando también costos de transacción.


\section{Primeros experimentos (cajas negras)}

Como una etapa preliminar se realizaron un conjunto de experimentos utilizando algoritmos de aprendizaje que pertenecen a la categoría de "cajas negras", concretamente se probaron dos modelos distintos:

\begin{itemize}
	\item Máquinas de soporte vectorial.
	\item Perceptrón multicapa.
\end{itemize}

\subsection{Conjunto de datos}

Se utilizaron precios diarios (precio de apertura, precio máximo, precio mínimo, precio de cierre) para el TRAC \textbf{NAFTRAC ISHRS}, el periodo elegido fue del 4 de febrero de 2014 al 5 de abril de 2018.\footnote{Estos datos fueron obtenidos de Yahoo Finance, https://finance.yahoo.com/}.

Vale la pena señalar que este conjunto de datos no es un conjunto de datos etiquetado, por lo tanto, una primera etapa consistió en idear una forma de etiquetarlos; este problema se abordó tratando de resolver la siguiente pregunta

\begin{center}
	\textit{Dados los precios históricos, ¿qué debí haber hecho para obtener ganancias?}
\end{center}


\subsubsection{Conjuntos de entrenamiento y prueba\\}

Para obtener los conjuntos de entrenamiento y prueba, los datos se dividieron en periodos de tres meses iniciando el día 4 de febrero de 2014. Después de cada periodo de entrenamiento de tres meses, los siguientes tres meses se consideran un periodo de prueba, este mismo periodo de prueba será después un nuevo conjunto de entrenamiento y así sucesivamente.

\begin{table}[H]
\caption{Periodos de entrenamiento y prueba}
\label{tabla-entrena-prueba}
\centering
\begin{tabular}{p{3.5cm}p{3.5cm}p{3.5cm}p{2.0cm}}
\hline Inicio entrenamiento & Fin entrenamiento & Inicio prueba & Fin prueba \\ 
\hline 2014-02-04 & 2014-04-30 & 2014-05-02 & 2014-07-31 \\ 
 2014-05-02 & 2014-07-31 & 2014-08-04 & 2014-10-31 \\ 
 2014-08-04 & 2014-10-31 & 2014-11-03 & 2015-01-30 \\ 
 2014-11-03 & 2015-01-30 & 2015-02-03 & 2015-04-30 \\ 
\hline 
\end{tabular}

\end{table} 

Utilizando esta forma de separar los datos fue posible obtener 16 conjuntos de entrenamiento y 16 de prueba.

\subsection{Proceso de etiquetado}

Como se mencionó anteriormente, necesitamos etiquetar cada observación en el conjunto de entrenamiento de acuerdo a una de las tres posibles acciones: comprar, vender o esperar. Para automatizar dicho etiquetado, se utilizó un algoritmo genético el cual busca la mejor estrategia para el periodo dado, esto es, la estrategia que habría generado mejores ganancias (o menores pérdidas) que aquellas generadas por la estrategia Buy and Hold.

Cada individuo en la población fue codificado como un vector, $\mathbf{x}$, que representa una estrategia de operación. La longitud de $\mathbf{x}$ es igual al número de días en el conjunto de entrenamiento y cada entrada en este vector puede tomar un valor del conjunto $\{-1,0,1\}$, en donde cada número $-1, 0, 1$ se interpreta, respectivamente, como: vender, esperar, comprar. De esta manera la \textit{i-ésima} componente del vector $\mathbf{x}$ representa la decisión que se toma en el día $i$.

Así pues, el algoritmo busca la mejor combinación de $-1, 0, 1$ que maximiza (minimiza) la ganancia (pérdida), la cual se calcula como el \textbf{exceso de ganancia} sobre la estrategia Buy and Hold, es decir, la resta de la ganancia generada por $\mathbf{x}$ y la generada por seguir Buy and Hold (BH).

\begin{center}
	$Ex = Ganancia(\mathbf{x}) - Ganancia(BH)$
\end{center}

En la siguiente figura se muestra el resultado del proceso de etiquetado para un conjunto de entrenamiento. Nótese que el algoritmo encuentra una estrategia en la cual se compra barato y se vende caro.

\begin{figure}[H]
	\centering
	\rotatebox{0}{\includegraphics[width=1.0\linewidth]{imagenes/etiquetamiento_ENG}}
	\caption{Resultado del proceso de etiquetado para un conjunto de entrenamiento}
	\label{fig:etiquetamiento}
\end{figure}

\subsection{Atributos}
Como atributos se utilizaron los siguientes precios:

\begin{itemize}
	\item Precio de apertura del día.
	\item Precio mínimo del día.
	\item Pecio máximo del día.
	\item Precio de de cierre del día.
\end{itemize}

\subsection{Resultados}
Para cada conjunto de entrenamiento y prueba, los siguientes modelos fueron utilizados (la motivación de elegir estos modelos se basó únicamente en su popularidad, ver \cite{bishop} para una descripción más detallada de sus propiedades matemáticas)

\begin{itemize}
	\item Máquina de soporte vectorial con kernel gaussiano y asignando un peso de $0.45, 0.10, 0.45$ para las clases $-1, 0, 1$ respectivamente.
	
	\item Perceptrón multicapa con una capa oculta de 10 neuronas, función de activación \textit{ReLu}.
\end{itemize}

Como se explicó anteriormente, la medida de desempeño fue el \textbf{exceso de ganancia}, la cual se calculó utilizando los siguiente supuestos:
 
%\subsubsection{Assumptions}
\begin{itemize}
	
	\item No se permiten ventas en corto, esto quiere decir que únicamente se puede vender cuando se ha comprado en un momento anterior. (no podemos vender algo que no poseemos)
	
	\item No se permite la ejecución de señales sucesivas repetidas, es decir, si ejecutamos una compra, invertimos todo nuestro capital disponible en ese momento; de la misma forma, al vender, vendemos todo lo que sea posible.
	
	\item Ya que utilizamos datos al cierre del día, si tenemos una señal de compra o venta en el día $t$, entonces compramos o vendemos (precio de ejecución) a un precio igual al promedio del precio máximo y precio mínimo del día $t+1$.\\
	
	\item El costo de cada transacción genera una comisión del $0.25 \%$. Por ejemplo, si compramos una acción que cuesta $\$10$, entonces el capital necesario para ejecutar dicha operación es igual a $\$10(1+0.0025)$; de la misma forma, si vendemos una acción en $\$10$, terminamos recibiendo una cantidad de $\$10(1-0.0025)$

\end{itemize}

Para cada conjunto de prueba, se obtuvieron los siguientes resultados:

\begin{table}[H]
\caption{Resultados obtenidos en cada modelo}
\label{table excess returns}
\centering
\begin{tabular}{p{5cm}rr}
	\hline
	\multicolumn{3}{r}{Exceso de ganancia (porcentaje)} \\
	\hline
	Test set & SVM & MLP \\
	\hline
	2014-05-02 / 2014-07-31 & -0.013  & -0.067 \\
	2014-08-04 / 2014-10-31 & 0.0 & -0.006 \\
	2014-11-03 / 2015-01-30 & 0.0 & 0.0  \\
	2015-02-03 / 2015-04-30 & -0.058 &  -0.066 \\
	2015-05-04 / 2015-07-31 & 0.0 & 0.0  \\
	2015-08-03 / 2015-10-30 & 0.02 & 0.0 \\
	2015-11-04 / 2016-01-29 & 0.113 & 0.054 \\
	2016-02-02 / 2016-04-28 & -0.053 & -0.025 \\
	2016-05-02 / 2016-07-29 & 0.046 & -0.025\\
	2016-08-01 / 2016-10-31 & 0.003 & -0.027\\
	2016-11-01 / 2017-01-31 & 0.028 & 0.004\\
	2017-02-01 / 2017-04-28 & -0.008 & -0.045\\
	2017-05-02 / 2017-07-31 & -0.029 & -0.029\\
	2017-08-01 / 2017-10-31 & 0.016 & 0.054 \\
	2017-11-03 / 2018-01-31 & -0.033 & 0.032 \\
	2018-02-01 / 2018-04-05 & 0.0 & 0.0\\
	
	\hline
	Suma & 0.32 & -0.174 \\
	
	\hline
	Promedio & 0.002 & -0.01\\
	\hline
	Número de escenarios positivos &  6 & 4 \\
	\hline
	Número de escenarios negativos & 6 & 8 \\  
	

	\hline 
\end{tabular}
\end{table}	

Como podemos observar, los mejores resultados se obtuvieron con la máquina de soporte vectorial,  desafortunadamente, si utilizamos una prueba estadística del tipo \textit{t de Student} para la media (con un nivel de confianza del $95 \%$) encontramos que no es posible rechazar la hipótesis nula (la verdadera media es cero). Por lo tanto, estadísticamente hablando, no podemos concluir que esta metodología sea superior a la inversión pasiva.

\section{Trabajo futuro cuarto semestre}

Para el cuarto semestre estaré enfocándome en los siguientes puntos:

\begin{itemize}
	\item Explorar distintos paradigmas simbólicos de aprendizaje supervisado. La idea es obtener un conjunto de reglas \textit{if-then}.
	\item Incluir indicadores técnicos en el conjunto de atributos.
	\item Experimentar con distintas frecuencias de muestreo para construir los conjuntos de entrenamiento y prueba.
	\item Explorar otras formas de etiquetado de datos.
\end{itemize}

\newpage 
\bibliographystyle{splncs04}
\bibliography{referencias}{}



\end{document}