\documentclass[10pt,letterpaper,onecolumn]{llncs}
\usepackage[latin1]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{cite}
\usepackage{caption}
\usepackage{float}

\pagestyle{empty}
\begin{document}


\title{Aprendizaje de reglas para operaciones en el mercado accionario. \\
Avances de tesis \\ Tercer semestre.}

\author{David Ricardo Montalván Hernández}

\institute{ Instituto Politécnico Nacional, Centro de Investigación en Computación, Ciudad de México, México.\\
\email{davidricardo888}@gmail.com}

\maketitle


\begin{abstract}

Con la digitalización de los mercados financieros, en particular, los mercados accionarios; el desarrollo de algoritmos y técnicas computacionales para determinar las estrategias de inversión ha ganado relevancia tanto en la industria como en la academia.

Concretamente, técnicas relacionadas al aprendizaje automático han ganado notoriedad en los últimos años. Dentro de estas técnicas, aquellas que pertenecen a la categoría de "\textbf{cajas negras}" (e.g. máquinas de soporte vectorial, redes neuronales) son las que han tenido una mayor difusión, teniendo menor presencia las llamadas técnicas simbólicas "\textbf{cajas blancas}".

En este trabajo, presento los avances obtenidos hasta el momento en la investigación relacionada a mi tema de tesis. Retomo primeramente algunos conceptos básicos para el entendimiento del tema y posteriormente se analiza el estado del arte recolectado. Se muestran algunos ejercicios bajo del paradigma de "\textbf{cajas negras}" y se señala el camino a tomar para el cuarto semestre, en el cual se realizarán ejercicios bajo el paradigma de "\textbf{cajas blancas}".

\end{abstract}


\section{Conceptos Básicos}

\subsection{El sistema financiero}

El sistema financiero se compone de distintos tipos de mercados (e.g. accionario, deuda, cambiario) junto con la participación de distintos intermediarios (personas físicas o morales) los cuales buscan la transferencia de activos (tangibles o intangibles) de un lugar a otro y de un punto en el tiempo a otro.

Los intermediarios recurren al sistema financiero principalmente por las siguientes razones:

\begin{itemize}
	\item Ahorrar dinero para el futuro.
	\item Pedir prestado dinero para utilizarlo en el presente.
	\item Reunir capital para proyectos de inversión futuros.
	\item Administrar riesgos.
\end{itemize}

Dado lo anterior, resulta evidente entonces, que la principal función del sistema financiero es facilitar la negociación entre los intermediarios que participan en el.

\subsection{Acciones y títulos referenciados a acciones}
Para financiar sus proyectos de inversión, las compañías pueden recurrir a distintas formas de financiamiento, entre ellas:

\begin{itemize}
	\item Solicitar un préstamo ante una entidad de crédito.
	\item Emisión o venta de acciones a los inversionistas (accionistas).
\end{itemize}

La primera de estas opciones implica una deuda que se tendrá que pagar (con intereses) en un tiempo futuro; mientras que la segunda involucra ceder una fracción de la compañía hacia los inversionistas, así como garantizarles ciertos derechos sobre los activos de esta.

Así pues, podemos decir que una \textbf{acción} es un activo financiero que representa cierta proporción de los activos de la compañía.

\subsubsection{Títulos referenciados a acciones (TRAC's) \\}

De acuerdo a la página de la Bolsa Mexicana de Valores\footnote{https://www.bmv.com.mx/es/mercados/instrumentos}:\\
\textit{los \textbf{Títulos referenciados a acciones (TRAC's)} son certificados de participación que representan el patrimonio de fideicomisos de inversión y que mantienen en posición canastas de acciones de empresas cotizadas en bolsa} (en términos simples, un TRAC es un activo financiero que representa el comportamiento de un conjunto de acciones)

En México, el TRAC más importante es el \textbf{NAFTRAC ISHRS} el cual está referenciado a las acciones que componen el Índice de Precios y Cotizaciones (S\&P/BMV IPC), el principal indicador del mercado accionario mexicano.

\subsection{Análisis técnico}
Al momento de invertir, aún cuando la idea básica es \textit{comprar barato y vender caro}, dada la incertidumbre en los mercados financieros, se han desarrollado distintas técnicas para analizar la información financiera.

El análisis técnico es una forma de análisis financiero el cual utiliza precios y volúmenes históricos para guiar la toma de decisiones. Generalmente, este tipo de análisis recurre al uso de gráficas para descubrir patrones y tendencias en los precios.

Además, el análisis técnico podría considerarse como el estudio colectivo de la psicología de los inversionistas; ya que, al sólo analizar precios y volúmenes, se analiza el sentimiento de aquellos inversionistas que efectivamente realizaron una transacción (es decir, aquellos inversionistas que lograron realizar una compra o una venta).

\subsubsection{Indicadores técnicos}
Además de utilizar herramientas gráficas para la toma de decisiones, el análisis técnico se vale de los llamados "indicadores técnicos". Estos indicadores, son medidas basadas en el precio, volumen o flujos de fondos que pueden ser utilizadas para predecir cambios en los precios.

\subsection{Hipótesis del mercado eficiente}
La eficiencia de un mercado se refiere a la rapidez en que los precios de este reflejan la información disponible. Si los precios no reflejan totalmente la información, entonces la recopilación y procesamiento de esta podría generar ganancias anormales.

Así pues, decimos que un mercado es \textbf{informacionalmente eficiente (eficiente)} si los precios reflejan la información de manera rápida y racional.

Un mercado eficiente implica la existencia de precios informativos lo que permite a su vez determinar que compañías o proyectos obtendrán el capital que necesitan para su desarrollo, fomentando así el crecimiento económico. Por lo tanto, la eficiencia en un mercado es una característica importante de un sistema financiero sano.

En la práctica, los mercados financieros no se consideran completamente eficientes o ineficientes si no que se encuentran en un rango entre estos dos extremos.

\subsubsection{Formas de eficiencia en el mercado\\}

Se consideran tres formas de eficiencia en el mercado, \cite{Fama1965}, de acuerdo al tipo de información reflejada:\\
\begin{table}
\caption{Formas de eficiencia en el mercado}
\label{tabla-formas-eficiencia}
\centering	
\begin{tabular}{p{3.0cm}p{3.0cm}p{3.0cm}p{3.5cm}}
\hline \textbf{Eficiencia} & \textbf{Precios históricos} & \textbf{Información pública} & \textbf{Información privada} \\ 
\hline Débil & \checkmark  &  &  \\ 
\hline Semi fuerte & \checkmark & \checkmark &  \\ 
\hline Fuerte & \checkmark & \checkmark & \checkmark \\ 
\hline 
\end{tabular} 
\end{table}

En su forma débil, los precios reflejan eficientemente toda la información histórica generada por el mercado (precios de apertura, cierre, máximos, mínimos, volumen) por lo tanto, los inversionistas no pueden predecir los precios futuros sólamente extrapolando la información histórica.

En su forma semi fuerte, los precios reflejan toda la información pública conocida y disponible; esta información incluye tanto la información revelada en los estados financieros de las compañías como la información generada por el mercado. Es claro entonces que un mercado con eficiencia semi fuerte, también es débilmente eficiente y además cualquier intento de utilizar la información pública disponible será insustancial al momento de predecir los precios del futuro.

Finalmente, un mercado con eficiencia fuerte es aquel en el que los precios reflejan completamente tanto la información pública como la privada (aquella que sólo unos cuantos poseen) y por lo tanto, el uso de esta información para predecir los precios futuros no tiene trascendencia.

\subsubsection{Estrategia Buy and Hold\\}

En un mercado eficiente, los inversionistas optarán por seguir una estrategia de \textbf{inversión pasiva}, es decir, aquella en la que no se realizan cambios al portafolio debido a las expectativas en el corto plazo. Una inversión pasiva consiste pues, en lo siguiente:

\begin{itemize}
	\item[-] Fijar un periodo de tiempo $[0,T]$.
	\item[-] Comprar en $0$ a un precio $P_{0}$.
	\item[-] Vender en $T$ a un precio $P_{T}$.
\end{itemize}

En inglés, esta estrategia se conoce como \textbf{Buy and Hold} y será la estrategia utilizada como referencia.

Por otra lado, en un mercado ineficiente, los inversionistas optarán por seguir una estrategia de \textbf{inversión activa}. Este tipo de inversión busca generar ganancias superiores a aquellas generadas por la inversión pasiva y consiste en: 

\begin{itemize}
	\item[-] Fijar un periodo de tiempo $[0,T]$.
	\item[-] Comprar en un conjunto de fechas $\{\tau_{c1} < \tau_{c2}, \ldots, \tau_{cn}<T\}$ a precios $\{P_{\tau_{c1}}, P_{\tau_{c2}}, \ldots, P_{\tau_{cn}}   \}$.
	\item[-] Vender en un conjunto de fechas $\{\tau_{v1}, \tau_{v2}, \ldots, \tau_{vn}<=T\}$ a precios $\{P_{\tau_{v1}}, P_{\tau_{v2}}, \ldots, P_{\tau_{vn}}   \}$.
\end{itemize}

En donde las variables $\tau$ y $P$ son variables aleatorias.

Si el mercado es ineficiente, entonces existe una estrategia de inversión activa que generará ingresos netos (es decir, considerando costos de transacción) superiores a aquellos generados por una inversión pasiva.


\section{Estado del arte}

En la búsqueda de estrategias de inversión activa que superen a la estrategia \textit{Buy and Hold}, se han explorado distintas técnicas relacionadas al área de inteligencia artificial, por ejemplo, uno de los primeros trabajos es el de \cite{Allen1999}, en el cual se utiliza programación genética para encontrar un conjunto de reglas que permiten indicar los momentos de compra, venta o espera; en este trabajo se analiza el mercado accionario de Estados Unidos utilizando el índice accionario \textit{S\&P 500} (este índice representa a las mejores 500 empresas de Estados Unidos) como instrumento de referencia, se consideran costos de transacción pero no logran vencer las ganancias de la inversión pasiva.\\

En \cite{Leigh2002}, se utilizan heurísticas (\textit{template matching}) basadas en los patrones de la gráfica del precio del índice accionario NYSE Composite (Estados Unidos), se obtienen ganancias superiores a la inversión pasiva pero no se consideran costos de transacción.\\

En \cite{Potvin2004}, se retoma el trabajo de \cite{Allen1999} omitiendo costos de transacción y considerando una forma distinta de generar la población de árboles. Vencen a la estrategia Buy and Hold únicamente en mercados estables o a la baja, pero no logran vencerla en mercados a la alza. En este trabajo en lugar de utilizar índices accionarios se analizan acciones individuales del mercado de Canadá.\\

Siguiendo la línea de programación genética, los autores en \cite{Scott2010} utilizan no sólamente precios diarios, como lo hicieron los trabajos previamente mencionados, si no que también consideran precios semanales y mensuales. Utilizan el índice \textit{S\&P 500} como instrumento de referencia y logran vencer la estrategia Buy and Hold aún considerando costos de transacción.\\
	
\cite{Canelas2012, Canelas2013, Leitao2016} Son una serie de trabajos en los cuales se definen los \textit{Puntos Perceptualmente Importantes (Perceptually Important Points, PIP)} y se utiliza un método llamado \textit{Aproximación Agregada Simbólica, (Symbolic Aggregate Approximation, SAX)}; con estas dos herramientas es posible reducir la dimensionalidad de la serie de tiempo (sólo se consideran los "puntos importantes", en lugar de la serie en su totalidad) y a su vez convertirla en una serie de símbolos (letras de un alfabeto) finalmente se aplica un algoritmo evolutivo para identificar los patrones de símbolos que nos permiten obtener una buena estrategia. Se analiza el mercado de Estados Unidos utilizando el índice \textit{S\&P 500} y obtienen mejores resultados que la estrategia Buy and Hold aunque no consideran costos de transacción.


En \cite{Kampouridis2017} se considera una escala de tiempo basada en eventos y se definen los \textit{cambios direccionales}. Utilizando este concepto se generan estrategias capaces de vencer a la estrategia Buy and Hold aún considerando costos de transacción. Este artículo no analiza el mercado accionario, si no que analiza el mercado de divisas.


Los autores en \cite{Huang2015}, proponen utilizar un biagrupamiento (biclustering) para descubrir patrones, este biagrupamiento agrupa tanto en la dimensión del tiempo como en la dimesión de los atributos. Una vez obtenidos los grupos para cada decisión (compra, venta o espera), se utiliza una modificación del método de K vecinos más cercanos con el fin de obtener una decisión para el día en cuestión. Obtienen resultados favorecedores analizando distintos mercados accionarios (Estados Unidos, Asia, Canadá) pero no consideran costos de transacción.

\cite{Preen2010, Zhang2015} Utilizan una metodología llamada \textit{Extended Classifier Systems, XCS} la cual les permite obtener un conjunto de reglas \textit{if-then} para decidir la acción a tomar en el día en cuestión. \cite{Zhang2015} analiza el mercado de índices accionarios de la bolsa de Shangai y vence a la estrategia Buy and Hold considerando costos de transacción, mientras que \cite{Preen2010} analiza diferentes acciones e índices accionarios venciendo a la estrategia Buy and Hold en la mayoría de los casos, considerando también costos de transacción.


\section{Primeros experimentos (cajas negras)}
\subsection{Datasets}

We used daily price data (open price, maximum price, minimum price, adjusted close price) from Yahoo Finance \footnote{https://finance.yahoo.com/} for NAFTRAC for a time period between February 4th 2014 up to April 5th 2018.

Worth mention that this is an unlabeled dataset, hence, we first need to find a way to label it in order to use supervised pattern recognition techniques. The approach taken is based on the idea of "given the historical prices, what should one have had to do in order to make profits?"

\subsubsection{Training set and test set}

For obtaining the training and test sets, the data was divided in three-months periods, starting on the day February 4th 2014. Following a three-months training period, there is a three-months test period, which later will become the new three-months training period, that is, we use a rolling window to separate the dataset as shown in the table below.

\begin{table}[H]
\caption{Training and test set separation}
\label{tabla-entrena-prueba}
\centering
\begin{tabular}{p{2.5cm}p{2.5cm}p{2.5cm}p{2.5cm}}
\hline Start training & End training & Start test & End test \\ 
\hline 2014-02-04 & 2014-04-30 & 2014-05-02 & 2014-07-31 \\ 
 2014-05-02 & 2014-07-31 & 2014-08-04 & 2014-10-31 \\ 
 2014-08-04 & 2014-10-31 & 2014-11-03 & 2015-01-30 \\ 
 2014-11-03 & 2015-01-30 & 2015-02-03 & 2015-04-30 \\ 
\hline 
\end{tabular}

\end{table} 

Using the procedure above, we were able to obtain 16 training/test datasets.


\subsection{Labeling process}

As mentioned before, we need to label each observation in the training datasets according to one of the three possible actions: buy, sell or hold. To achieve this we used an Estimation Distribution Algorithm (EDA, \cite{dan-simon}), namely, we used a version of an Univariate Marginal Distribution Algorithm (UMDA).   

This algorithm tries to find the best strategy for the given training period, that is, the strategy that would have generated a bigger (minor) profit (loss) compared to the BH strategy.

Each individual in the population was encoded as a vector, $\mathbf{x}$, representing a trading strategy and having length equal to the number of trading days in the training period. Each entry in the vector takes a value in the set $\{-1,0,1\}$, where $-1,0,1;$ represents a sell, hold and buy signal respectively. Thus the \textit{i-th} component is the decision taken on day $i$. The algorithm finds the combination maximizing the profit, which is measured as the \textbf{Excess Return} over the BH strategy, that is, the return generated by the vector $\mathbf{x}$ minus the return generated by BH.

\begin{figure}[H]
	\centering
	\rotatebox{0}{\includegraphics[width=1.0\linewidth]{imagenes/etiquetamiento_ENG}}
	\caption{Results from the labeling process}
	\label{fig:etiquetamiento}
\end{figure}

\subsection{Features}

For each day, the open, minimum, maximum and adjusted close prices were used as features.


\subsection{Results}

For every training and test set, the following models were tested\footnote{We chose these models since they're among the most popular ones used in the pattern recognition literature (see \cite{bishop} and \cite{quinlan} for their mathematical description) .
}:

\begin{itemize}

	\item Support Vector Machine with gaussian kernel and assigning class weigths of $0.45, 0.10, 0.45$ for classes $-1, 0, 1$ respectively. 
	
	\item Multilayer perceptron with a hidden layer with 10 neurons and \textit{ReLu} as activation function.
	
	
	\item C4.5 tree with max depth of 5.	
	
\end{itemize}


As described above, the performance measure was \textbf{Excess Return} which is calculated using the following assumptions:

%\subsubsection{Assumptions}
\begin{itemize}

	\item No short-sales allowed, this means that one can only sell if a buy action occurred in the past (we can't sell something that we don't own).
	
	\item Once a trading signal is activated, we have to wait until we see a different one, so no repetitions of the same signal are allowed. This avoids excessive buys or sells.
		
	\item Since we are using end of day data, if we have a buy or sell signal on day $t$, then the buy or sell price (execution price) is the average between the minimum and maximum price at day $t+1$.
	
	\item The cost of every transaction is equal to a $0.25 \%$ over the total cost. For example, if a stock was bought  at a price of $\$10$, then the actual monetary amount paid for it is equal to $\$10(1+0.0025)$; likewise if a stock was sold at a price of $\$10$ we end up receiving. a monetary amount of $\$10(1-0.0025)$.
\end{itemize}

For every test set and every model we obtained the following results.

\begin{table}[H]
\caption{Results obtained for every model}
\label{table excess returns}
\centering
\begin{tabular}{p{5cm}rrr}
	\hline
	\multicolumn{4}{r}{Excess Return} \\
	\hline
	Test set & SVM & MLP & C4.5 \\
	\hline
	2014-05-02 / 2014-07-31 & -0.013  & -0.067 & -0.067 \\
	2014-08-04 / 2014-10-31 & 0.0 & -0.006 & -0.006 \\
	2014-11-03 / 2015-01-30 & 0.0 & 0.0 & 0.0 \\
	2015-02-03 / 2015-04-30 & -0.058 &  -0.066 & -0.07 \\
	2015-05-04 / 2015-07-31 & 0.0 & 0.0 & -0.039 \\
	2015-08-03 / 2015-10-30 & 0.02 & 0.0 & 0.025 \\
	2015-11-04 / 2016-01-29 & 0.113 & 0.054 & 0.091 \\
	2016-02-02 / 2016-04-28 & -0.053 & -0.025 & -0.065 \\
	2016-05-02 / 2016-07-29 & 0.046 & -0.025 &  -0.024 \\
	2016-08-01 / 2016-10-31 & 0.003 & -0.027 & -0.027 \\
	2016-11-01 / 2017-01-31 & 0.028 & 0.004 & 0.01 \\
	2017-02-01 / 2017-04-28 & -0.008 & -0.045 & -0.047 \\
	2017-05-02 / 2017-07-31 & -0.029 & -0.029 & -0.014 \\
	2017-08-01 / 2017-10-31 & 0.016 & 0.054 & 0.045 \\
	2017-11-03 / 2018-01-31 & -0.033 & 0.032 & -0.06 \\
	2018-02-01 / 2018-04-05 & 0.0 & 0.0 &  0.069 \\
	
	\hline
	Overall sum & 0.32 & -0.174 & -0.179 \\
	
	\hline
	Average & 0.002 & -0.01 & -0.011 \\
	\hline
	Number of positive excess returns &  6 & 4 & 5 \\
	\hline
	Number of negative excess returns & 6 & 8 & 10 \\  
	

	\hline 
\end{tabular}
\end{table}	

\newpage

\section{Conclusions}

As we can observe, among the three models used, the best results were obtained by the Support Vector Machine.

Unfortunately, even tough when in this model we obtained a positive average excess return, using a t-test for the mean (with a confidence level of $95 \%$) we found that is not possible to reject the null hypothesis (the true mean is zero) thus, statistically speaking, we can't conclude that this method beats the BH strategy systematically.

Nonetheless it's worth to mention that thanks to the labeling method we can explore further other types of supervised learning techniques whether using a symbolic or sub-symbolic approach.

The future directions for this work might be:

\begin{itemize}
	\item Explore symbolic approaches for supervised learning, such as Extended Classifier System (XCS).
	\item Analyze the inclusion of technical indicators.
	\item Use another set of features.
	\item Use other sampling frequencies.
	\item Use risk-adjusted performance measures.
\end{itemize}

\newpage 
\bibliographystyle{splncs04}
\bibliography{referencias}{}



\end{document}